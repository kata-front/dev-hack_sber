services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: quizbattle-api
    environment:
      CORS_ALLOW_ORIGINS: ${CORS_ALLOW_ORIGINS:-*}
      GEMINI_API_KEY: ${GEMINI_API_KEY:-}
      GEMINI_MODEL: ${GEMINI_MODEL:-gemini-2.5-flash}
      GEMINI_TIMEOUT_SECONDS: ${GEMINI_TIMEOUT_SECONDS:-35}
      STATE_DIR: /data
      ROOM_STATE_FILE: /data/rooms_state.json
      SESSION_STATE_FILE: /data/sessions_state.json
      SOCKET_DISCONNECT_GRACE_SECONDS: ${SOCKET_DISCONNECT_GRACE_SECONDS:-20}
    volumes:
      - quiz_state:/data
    expose:
      - "8888"
    restart: unless-stopped

  front:
    build:
      context: ./front
      dockerfile: Dockerfile
      args:
        NPM_REGISTRY: ${NPM_REGISTRY:-https://registry.npmjs.org/}
        HTTP_PROXY: ${HTTP_PROXY:-}
        HTTPS_PROXY: ${HTTPS_PROXY:-}
        NO_PROXY: ${NO_PROXY:-localhost,127.0.0.1,backend}
    container_name: quizbattle-front
    depends_on:
      - backend
    ports:
      - "8888:80"
    restart: unless-stopped

volumes:
  quiz_state:
