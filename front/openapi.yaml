openapi: 3.0.3
info:
  title: Dev Hack Sber API
  version: 1.1.0
  description: >-
    REST endpoints inferred from the frontend RTK Query slices plus documented
    Socket.IO interactions (see x-socket-io).
servers:
  - url: http://localhost:3000
paths:
  /check_pin:
    post:
      summary: Check room PIN
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckPinRequest"
            examples:
              sample:
                value:
                  pin: 1234
      responses:
        "200":
          description: PIN check result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
              examples:
                ok:
                  value:
                    ok: true
                    roomId: 101
                failed:
                  value:
                    ok: false
  /create_room:
    post:
      summary: Create a room
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DataFormCreateRoom"
            examples:
              sample:
                value:
                  roomId: 101
                  roomName: Team Alpha
                  quizTheme: History
                  maxParticipants: 8
      responses:
        "200":
          description: Room creation result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
              examples:
                ok:
                  value:
                    ok: true
                    roomId: 101
                failed:
                  value:
                    ok: false
  /create_room/{roomId}:
    get:
      summary: Init room (host)
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Room snapshot for host
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomInitHostResponse"
  /join_room/{roomId}:
    get:
      summary: Init room (participant)
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Room snapshot for participant
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomInitParticipantResponse"
  /start_game/{roomId}:
    post:
      summary: Start game for a room
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - roomId
              properties:
                roomId:
                  type: integer
                  format: int64
      responses:
        "200":
          description: Game state after start
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GameInfo"
components:
  schemas:
    CheckPinRequest:
      type: object
      required:
        - pin
      properties:
        pin:
          type: integer
          format: int32
    LoginResponse:
      type: object
      required:
        - ok
      properties:
        ok:
          type: boolean
        roomId:
          type: integer
          format: int64
    DataFormCreateRoom:
      type: object
      required:
        - roomId
        - roomName
        - quizTheme
        - maxParticipants
      properties:
        roomId:
          type: integer
          format: int64
        roomName:
          type: string
        quizTheme:
          type: string
        maxParticipants:
          type: integer
          format: int32
    TeamCommand:
      type: string
      enum:
        - red
        - blue
    StatusGame:
      type: string
      enum:
        - waiting
        - active
        - finished
    AnswerStatus:
      type: string
      enum:
        - correct
        - incorrect
    Question:
      type: object
      required:
        - question
        - team
        - answers
      properties:
        question:
          type: string
        team:
          $ref: "#/components/schemas/TeamCommand"
        answers:
          type: array
          items:
            type: string
        statusAnswer:
          $ref: "#/components/schemas/AnswerStatus"
    GameInfo:
      type: object
      required:
        - status
        - activeTeam
        - questions
        - activeQuestionIndex
        - counter
      properties:
        status:
          $ref: "#/components/schemas/StatusGame"
        activeTeam:
          $ref: "#/components/schemas/TeamCommand"
        questions:
          type: array
          items:
            $ref: "#/components/schemas/Question"
        activeQuestionIndex:
          type: integer
          format: int32
        counter:
          type: integer
          format: int32
    RoomMessage:
      type: object
      required:
        - command
        - createdAt
        - text
      properties:
        command:
          $ref: "#/components/schemas/TeamCommand"
        createdAt:
          type: string
          format: date-time
        text:
          type: string
    RoomMessageOutbound:
      type: object
      required:
        - roomId
        - text
        - command
        - createdAt
      properties:
        roomId:
          type: integer
          format: int64
        text:
          type: string
        command:
          $ref: "#/components/schemas/TeamCommand"
        createdAt:
          type: string
          format: date-time
    Participant:
      type: object
      required:
        - id
        - role
      properties:
        id:
          type: integer
          format: int32
          description: Socket id
        command:
          $ref: "#/components/schemas/TeamCommand"
        role:
          type: string
          enum:
            - host
            - participant
    InfoRoom:
      type: object
      required:
        - roomId
        - roomName
        - quizTheme
        - maxParticipants
      properties:
        roomId:
          type: integer
          format: int64
        roomName:
          type: string
        quizTheme:
          type: string
        maxParticipants:
          type: integer
          format: int32
        messages:
          type: array
          items:
            $ref: "#/components/schemas/RoomMessage"
        participants:
          type: array
          items:
            $ref: "#/components/schemas/Participant"
        gameInfo:
          $ref: "#/components/schemas/GameInfo"
    RoomInitHostResponse:
      allOf:
        - $ref: "#/components/schemas/InfoRoom"
        - type: object
          required:
            - role
          properties:
            role:
              type: string
              enum:
                - host
                - participant
    RoomInitParticipantResponse:
      allOf:
        - $ref: "#/components/schemas/InfoRoom"
        - type: object
          required:
            - role
            - team
          properties:
            role:
              type: string
              enum:
                - host
                - participant
            team:
              $ref: "#/components/schemas/TeamCommand"
    AnswerPayload:
      type: object
      required:
        - roomId
        - questionIndex
        - answer
        - team
      properties:
        roomId:
          type: integer
          format: int64
        questionIndex:
          type: integer
          format: int32
        answer:
          type: string
        team:
          $ref: "#/components/schemas/TeamCommand"

x-socket-io:
  server: http://localhost:3000
  namespace: "/"
  events:
    - event: create_room
      direction: client->server
      description: Emit after GET /create_room/{roomId} to subscribe as host.
      payload:
        type: integer
        format: int64
        description: Room id number (payload is the raw roomId).
    - event: room_created
      direction: server->client
      description: Initial snapshot after host connected.
      payload:
        $ref: "#/components/schemas/RoomInitHostResponse"
    - event: join_room
      direction: client->server
      description: Emit after GET /join_room/{roomId} to subscribe as participant.
      payload:
        type: integer
        format: int64
        description: Room id number (payload is the raw roomId).
    - event: room_joined
      direction: server->client
      description: Initial snapshot after participant connected.
      payload:
        $ref: "#/components/schemas/RoomInitParticipantResponse"
    - event: player_joined
      direction: server->client
      description: Player joined notification.
      payload:
        $ref: "#/components/schemas/Participant"
    - event: message
      direction: bidirectional
      description: Chat message send/receive.
      payload:
        send:
          $ref: "#/components/schemas/RoomMessageOutbound"
        receive:
          $ref: "#/components/schemas/RoomMessage"
    - event: answer
      direction: client->server
      description: Submit an answer for current question.
      payload:
        $ref: "#/components/schemas/AnswerPayload"
    - event: new_question
      direction: server->client
      description: New question for a team.
      payload:
        $ref: "#/components/schemas/Question"
    - event: check_answer
      direction: server->client
      description: Answer result for last question.
      payload:
        $ref: "#/components/schemas/AnswerStatus"
    - event: game_finished
      direction: server->client
      description: Game finished state.
      payload:
        $ref: "#/components/schemas/StatusGame"
